entities:

  seaf.ba.meta:
    title: Метамодель БА
    description: Сущность для представлений БА

    schema: # Сущность seaf.ba.meta содержит только меню и общие презентации для БА и не предполагает, что для нее будут объявлены объекты

    menu: >
      (
        $treePaths:= function($nested, $items, $i, $path) {(
          $path:= $path!="" and $nested[$i] ? $path & "/" & $nested[$i].title : $path="" and $nested[$i] ? $nested[$i].title; 
          $items:= $nested[$i].link ? $append($items, {"location": $path, "link": $nested[$i].link, "order": $nested[$i].order? $nested[$i].order}): $items;
          $items:= $count($nested[$i].includes) > 0 ?
            $append($items, $treePaths($nested[$i].includes, [], 0, $path)): 
            $items;
          $i<$count($nested)-1 ? $treePaths($nested, $items, $i+1, $substringBefore($path, "/" & $nested[$i].title)) : $items
        )}; 

        $menu:= $reduce($map($$."seaf.nav", function($v) {(
          $distinct($treePaths($v, [], 0, ""))
        )}), $append)
      )

