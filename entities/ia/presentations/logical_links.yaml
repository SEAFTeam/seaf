entities:
  seaf.ia.logical_links:
    menu: >
      (
        {
          "location": "Архитектура/Информационная/Логическая модель/Связи",
          "link": "/entities/seaf.ia.logical_links/registry"
        }
      )

    presentations:
      registry:
        type: table
        headers:
          - value: title
            text: Наименование
            link: self_link
          - value: logical_entity
            text: Логическая сущность
            link: le_link
          - value: link_type
            text: Тип связи
          - value: plurality
            text: Множественность
          - value: linked_entity
            text: Связанная сущность
            link: entity_link
        source: >
          (
          [$."seaf.ia.logical_links".$spread().
              {
                  "title": $keys(),
                  "self_link": "/entities/seaf.ia.logical_links/card?id=" & $keys(),
                  "logical_entity": ($id := *.logical_entity; $$."seaf.ia.logical_entities".$spread()[$keys() = $id].*.title),
                  "le_link": "/entities/seaf.ia.logical_entities/card?id=" & *.logical_entity,
                  "link_type": *.type,
                  "plurality": *.plurality,
                  "linked_entity": ($id := *.linked_entity; $$."seaf.ia.logical_entities".$spread()[$keys() = $id].*.title),
                  "entity_link": "/entities/seaf.ia.logical_entities/card?id=" & *.linked_entity
              }
            ]
          )

      card:
        type: markdown
        template: templates/logical_link.md
        source: >
          (
            $."seaf.ia.logical_links".$spread()[$keys()=$params.id].{
              "id": $keys(),
              "code": *.code,
              "title": *.title,
              "status": *.status,
              "description": *.description,
              "logical_entity": *.logical_entity,
              "le_link": "/entities/seaf.ia.logical_entities/card?id=" & *.logical_entity,
              "linked_entity": *.linked_entity,
              "entity_link": "/entities/seaf.ia.logical_entities/card?id=" & *.linked_entity,
              "link_type": *.type,
              "plurality": *.plurality,
              "multiplicityA": *.multiplicityA,
              "multiplicityB": *.multiplicityB,
              "cardinality": *.cardinality
            }
          )

      registry_by_OE:
        type: table
        headers:
          - value: title
            text: Наименование
            link: self_link
          - value: link_type
            text: Тип связи
          - value: plurality
            text: Множественность
          - value: linked_entity
            text: Связанная сущность
            link: entity_link
        source: >
          (
            $param_id := $params.id;
            [$."seaf.ia.logical_links".$spread()[*.logical_entity = $param_id].({
              "title": $keys(),
              "self_link": "/entities/seaf.ia.logical_links/card?id=" & $keys(),
              "link_type": *.type,
              "plurality": *.plurality,
              "linked_entity": ($id := *.linked_entity; $$."seaf.ia.logical_entities".$spread()[$keys() = $id].*.title),
              "entity_link": "/entities/seaf.ia.logical_entities/card?id=" & *.linked_entity
            })]
          )

      registry_by_IE:
        type: table
        headers:
          - value: title
            text: Наименование
            link: self_link
          - value: link_type
            text: Тип связи
          - value: plurality
            text: Множественность
          - value: logical_entity
            text: Исходящая сущность
            link: entity_link
        source: >
          (
            $param_id := $params.id;
            [$."seaf.ia.logical_links".$spread()[*.linked_entity = $param_id].({
              "title": $keys(),
              "self_link": "/entities/seaf.ia.logical_links/card?id=" & $keys(),
              "link_type": *.type,
              "plurality": *.plurality,
              "logical_entity": ($id := *.logical_entity; $$."seaf.ia.logical_entities".$spread()[$keys() = $id].*.title),
              "entity_link": "/entities/seaf.ia.logical_entities/card?id=" & *.logical_entity
            })]
          )
