entities:
  seaf.ia.physical_tables:
    presentations:
      reestr:
        type: table
        headers:
          - value: name
            text: Наименование
            link: self_link
          - value: description
            text: Назначение
          - value: as
            text: АС
            link: as_link
          - value: rdb
            text: СУБД
          - value: logic_link
            text: Логическая сущность
            link: link
        source: >
          (
            [$."seaf.ia.physical_tables".$spread().
                {
                    "name": *.name,
                    "self_link": "/entities/seaf.ia.physical_tables/card?id=" & $keys(),
                    "description": *.description,
                    "as": *.as,
                    "as_link": "/entities/components/blank?dh-component-id=" & *.as,
                    "rdb": *.rdb,
                    "logic_link": ($id := *.logic_link; $$."seaf.ia.logical_entities".$spread()[$keys() = $id].*.name),
                    "link": "/entities/seaf.ia.logical_entities/card?id=" & *.logic_link
                }]
          )

      card:
        type: markdown
        template: templates/physical_table.md
        source: >
          (
            $."seaf.ia.physical_tables".$spread()[$keys()=$params.id].{
                  "id": $keys()[0],
                  "name": *.name,
                  "description": *.description,
                  "as": *.as,
                  "as_link": "/entities/components/blank?dh-component-id=" & *.as,
                  "rdb": *.rdb,
                  "db": *.db,
                  "schema": *.schema,
                  "loc_attr": *.loc_attr,
                  "logic_link": *.logic_link,
                  "link": "/entities/seaf.ia.logical_entities/card?id=" & *.logic_link
                }
          )

      reestr_by_LE:
        type: table
        headers:
          - value: name
            text: Наименование
            link: self_link
          - value: description
            text: Назначение
          - value: as
            text: АС
          - value: rdb
            text: СУБД
        source: >
          (
            [$."seaf.ia.physical_tables".$spread().(
            $id := $keys(); *[logic_link=$params.id].
              {
                    "name": name,
                    "self_link": "/entities/seaf.ia.physical_tables/card?id=" & $id,
                    "description": description,
                    "as": as,
                    "rdb": rdb
              }
            )]
          )

      reestr_by_AS:
        type: table
        headers:
          - value: name
            text: Наименование
            link: self_link
          - value: description
            text: Назначение
          - value: as
            text: АС
          - value: rdb
            text: СУБД
        source: >
          (
            [$."seaf.ia.physical_tables".$spread().(
            $id := $keys(); *[as=$params.id].
              {
                    "name": name,
                    "self_link": "/entities/seaf.ia.physical_tables/card?id=" & $id,
                    "description": description,
                    "rdb": rdb
              }
            )]
          )
